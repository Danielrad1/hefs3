# Xcode Cloud Pre-Deployment Checklist

## âœ… Files to Verify Before Pushing

Run these commands to confirm everything is ready:

```bash
cd /Users/danielrad/Desktop/repos/hefs2/memorize-app

# 1. Verify post-clone script exists and is executable
ls -la ci_post_clone.sh
# Should show: -rwxr-xr-x ... ci_post_clone.sh

# 2. Verify GoogleService-Info.plist is committed
git ls-files | grep GoogleService-Info.plist
# Should show: GoogleService-Info.plist

# 3. Verify ios/ folder is gitignored (should be empty)
git ls-files | grep "^ios/"
# Should show: (empty - no output)

# 4. Verify app.json is committed
git ls-files | grep app.json
# Should show: app.json

# 5. Verify package files are committed
git ls-files | grep -E "package.json|package-lock.json"
# Should show both files
```

## ğŸ“‹ Xcode Cloud Workflow Configuration

In Xcode Cloud, configure your workflow with these **exact** settings:

### General
- **Name**: Production Build (or your preference)
- **Repository**: Your git repo
- **Branch**: `main` or `master`

### Build Configuration
- **Xcode Project/Workspace**: `memorize-app/ios/Enqode.xcworkspace`
- **Scheme**: `Enqode`
- **Build Platform**: iOS
- **Start Condition**: Automatic (on push) or Manual

### Environment
- **Xcode Version**: Latest stable (15.x or newer)
- **macOS Version**: Latest available
- **Clean Build**: Recommended for first build

### Post-Clone Script
- **Location**: Repository root
- **Script Name**: `ci_post_clone.sh`
- **Automatically detected**: Xcode Cloud will find and run this script

## ğŸš€ After Configuring Workflow

1. **Commit all changes**:
   ```bash
   git add ci_post_clone.sh XCODE_CLOUD_CHECKLIST.md docs/XCODE_CLOUD_SETUP.md
   git commit -m "Add Xcode Cloud configuration and post-clone script"
   ```

2. **Push to your repository**:
   ```bash
   git push origin main
   ```

3. **Trigger a build** in Xcode Cloud:
   - Go to Xcode Cloud console
   - Select your workflow
   - Click "Start Build"

4. **Monitor the build logs**:
   - Look for post-clone script output (ğŸš€ emojis)
   - Verify `expo prebuild` runs successfully
   - Verify `pod install` completes
   - Check that workspace is found

## ğŸ› Common Issues & Quick Fixes

### Issue: "ci_post_clone.sh: Permission denied"
**Fix**: Make script executable
```bash
chmod +x memorize-app/ci_post_clone.sh
git add memorize-app/ci_post_clone.sh
git commit -m "Make post-clone script executable"
git push
```

### Issue: "Workspace not found at memorize-app/ios/Enqode.xcworkspace"
**Fix**: Check post-clone script logs for errors. Most likely:
- Node.js version incompatibility
- npm install failed
- expo prebuild failed

### Issue: "GoogleService-Info.plist not found"
**Fix**: Ensure file is committed:
```bash
git add memorize-app/GoogleService-Info.plist
git commit -m "Add GoogleService-Info.plist"
git push
```

### Issue: "Scheme 'Enqode' not found"
**Fix**: This should be auto-generated by `expo prebuild`. Check:
- Scheme name in workflow matches exactly: `Enqode`
- Post-clone script completed successfully
- Try rebuilding from scratch (Clean build)

## ğŸ“ Expected Build Output

When the build succeeds, you should see in the logs:

```
âœ… Running post-clone script: ci_post_clone.sh
ğŸš€ Starting Xcode Cloud post-clone setup...
ğŸ“¦ Installing Node dependencies...
ğŸ”¨ Running Expo prebuild to generate iOS folder...
ğŸ“‹ Copying GoogleService-Info.plist to iOS project...
ğŸ’ Installing CocoaPods...
ğŸ”„ Updating CocoaPods repo...
ğŸ“² Installing pod dependencies...
âœ… Post-clone setup complete!
ğŸ“ Workspace location: memorize-app/ios/Enqode.xcworkspace
```

Then Xcode Cloud will:
```
âœ… Opening workspace: memorize-app/ios/Enqode.xcworkspace
âœ… Building scheme: Enqode
âœ… Archive created successfully
```

## ğŸ‰ Success Criteria

Your build is successful when:
1. âœ… Post-clone script runs without errors
2. âœ… Workspace is generated and found
3. âœ… CocoaPods dependencies installed
4. âœ… Xcode builds the app
5. âœ… Archive is created
6. âœ… App is ready for TestFlight/App Store

---

**Need more details?** See `docs/XCODE_CLOUD_SETUP.md` for comprehensive documentation.
